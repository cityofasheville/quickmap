
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Water Rescue Point's</title>
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- Le styles -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 0px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>

    <script type="text/javascript" src="js/leaflet.js"></script>
    <link rel="stylesheet" href="css/leaflet.css" />
    <!--[if lte IE 8]>
     <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.ie.css" />
    <![endif]-->    <!-- <style type="text/javascript">#map { height: 180px; }</style> -->
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/jquery.ui.core.min.js"></script>
    <script type="text/javascript" src="js/jquery.ui.widget.min.js"></script>
    <script type="text/javascript" src="js/jquery.ui.position.min.js"></script>
    <script type="text/javascript" src="js/jquery.ui.autocomplete.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script type="text/javascript" src="js/tab.js"></script>
    <script type="text/javascript" src="js/typeahead.min.js"></script>
    <script type="text/javascript" src="js/quickmap.js"></script>
    <script src="js/Leaflet.fullscreen.js"></script>

    <link href="css/jquery-ui.css" rel="stylesheet">
    <link rel="stylesheet" href="css/leaflet.fullscreen.css"/>
     

    <style type="text/css">
      body,html { 
        height: 100%;
        width:  100%;
      }
      #map{
        float: right;
        height: 93%;
        width:  100%;
      }

      .fl{float:right;}
      .ui-autocomplete { position: absolute; cursor: default;z-index:9999 !important;}

      .record_list.deactive {
        display:none;
      }
      .panel{
        margin-bottom: 0px;
        border-radius: 0px 0px 0px 0px;
        border: 0px;
      }
      .badge-info {
        color: #ffffff;
        background-color: #428bca;
        border-color: #357ebd;
      }
      .zmlayer{
        margin:5px;
        font-size: 14px;        
      }
      .panel-maptitle{
        background-color: #428BCA;
        color:#ffffff;
        height:7%;
      }
      .btn-dd-title{
        font-size:18px;
        font-weight: bold;
      }
      .dd-primary{
        background-color: #428BCA;
        color:#ffffff;
      }
      .bnt-dd{
        border:0px;
        width: 100%;
      }
      .dd-drp{
        background-color: #428BCA;
        width:100%;
        height: 500px;
        overflow: scroll;
        -webkit-overflow-scrolling: touch; 
      }
      @media screen and (max-width: 780px){
        .panel-maptitle{
          height:10%;
        }
        #map{
          height:90% 
        }
        .dd-drp{
          height: 200px;
          border:1px;
          border-color:#ffffff;
        }
      }

      }

      
    .leaflet-control-zoom-fullscreen { background-image: url(img/icon-fullscreen.png);z-index:99999 }
    /* on selector per rule as explained here : http://www.sitepoint.com/html5-full-screen-api/ */
    #map:-webkit-full-screen { width: 100% !important; height: 100% !important; }
    #map:-moz-full-screen { width: 100% !important; height: 100% !important; }
    #map:full-screen { width: 100% !important; height: 100% !important; }
    </style>




  </head>


  <body data-twttr-rendered="true" background-color="#F0F0F0">  
    <div class="panel panel-maptitle">
      <div  class="panel panel-maptitle" >
        <center><span id="results"></span></center>

      </div>
    </div>
    
    <div id="map"></div>

</div> 


<script>
  $(function () {
    $('#myTab a:last').tab('show')
  })
</script>



    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript">


      $('#search').click(function() {
         if ( $('#txtSearch').val()){

             addressStr = $('#txtSearch').val();
             var urlStr = 'http://'+QuickMap.agsServerGeocode+'/'+QuickMap.agsServerInstanceNameGeocode+'/rest/services/'+QuickMap.geocdingLayerName+'/GeocodeServer/findAddressCandidates';
             var data={f:"json",Street:addressStr};

            $.ajax({
              url: urlStr,
              dataType: "jsonp",
              data: data,
              success: function (data) {
                if (data.candidates) {
                  item = data.candidates[0];
                  QuickMap.getLatLong({ label: item.address, value: item.address, x:item.location.x,y:item.location.y } );
                }
              }
            });


         }
      });
      $('#txtSearch').autocomplete({
          source: function (request, response) {
                  //This is for geocoding
             addressStr = $('#txtSearch').val();
             var urlStr = 'http://'+QuickMap.agsServerGeocode+'/'+QuickMap.agsServerInstanceNameGeocode+'/rest/services/'+QuickMap.geocdingLayerName+'/GeocodeServer/findAddressCandidates';
             var data={f:"json",Street:addressStr};

            $.ajax({
              url: urlStr,
              dataType: "jsonp",
              data: data,
              success: function (data) {
                if (data.candidates) {
                  response($.map(data.candidates.slice(0, 14), function (item) {//only display first 10
                    return { label: item.address, value: item.address, x:item.location.x,y:item.location.y } 
                  }));
                }
              }
            });
          },
          minLength: 5,
          select: function (event, ui) {
            this.blur();
            QuickMap.getLatLong(ui.item);
          }
        });
        
        var mapAttr = 'Map data from The City of Asheville , NC',
        mapUrl = 'http://gis.ashevillenc.gov/tiles/basemapbw/{z}/{x}/{y}.png';


        var basemapsld = L.tileLayer(
          mapUrl, 
          {
            maxZoom: 19,
            minZoom: 11,
            tms: true,
            attribution:mapAttr,
        });

       var wr= L.tileLayer(
          'http://gis.ashevillenc.gov/tiles/waterrescue/{z}/{x}/{y}.png', 
          {
            maxZoom: 19,
            minZoom: 14,
            tms: true,
            attribution:mapAttr,
        });

       var map = new L.Map(
        'map', 
        {
          fullscreenControl: true,
          layers: [basemapsld,wr]
        }).setView([35.593,-82.5488], 14)
   
        map.on('fullscreenchange', function () {
            if (map.isFullscreen()) {
                console.log('entered fullscreen');

            } else {
                console.log('exited fullscreen');
            }
        });


      map.addEventListener('click', onMapClick);

      var baseLayers = {
        "Street Map": basemapsld,
      };

      QuickMap.dataDriveMap=true;
      QuickMap.getlist();

      map.on('enterFullscreen', function(){
        if(window.console) window.console.log('enterFullscreen');
      });
      
      map.on('exitFullscreen', function(){
        if(window.console) window.console.log('exitFullscreen');
      });
    
   QuickMap.identifyConfig={
    "service":"coa_water_rescue_points",
    layers:[{
      "layerindex":0,
      "layerlabel":"Water Rescue Point",
      fields:[{
          "id":0,
          "name":"Label",
          "style":"key", 
          "label":"Name"
        },
        {
          "id":1,
          "name":"Elevation",
          "style":"number", 
          "label":"Elevation"
        },
        {
          "id":2,
          "name":"Address",
          "style":"text", 
          "label":"Address"
        },
        {
          "id":3,
          "name":"River_Side",
          "style":"text", 
          "label":"River Side"
        },
        {
          "id":4,
          "name":"access_cond",
          "style":"currency", 
          "label":"Access Condition"
        },
        {
          "id":5,
          "name":"Type_Access",
          "style":"text", 
          "label":"Access From"
        },
        {
          "id":5,
          "name":"Sign",
          "style":"text", 
          "label":"Sign"
        },
        {
          "id":5,
          "name":"Access_Cond",
          "style":"text", 
          "label":"Access Condition"
        }],
      }],
  };
    function onMapClick(e) {
      QuickMap.getStateplane(e);
    }

    function DoTheCheck() {
      if (document.checkform.getfeatureinfo.checked == true)
        {map.addEventListener('click', onMapClick);}
      if (document.checkform.getfeatureinfo.checked == false)
        {map.removeEventListener('click', onMapClick); map.closePopup(popup);}
    }

    </script>
 
  </body>
</html>